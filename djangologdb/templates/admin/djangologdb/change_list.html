{% extends "admin/change_list.html" %}
{% load adminmedia admin_list i18n djangologdb %}

{% block extrastyle %}
	{{ block.super }}

	<!--[if IE]><script type="text/javascript" src="/media/djangologdb/js/excanvas.min.js"></script><![endif]-->
	<script type="text/javascript" src="/media/djangologdb/js/jquery-1.3.2.min.js"></script>
	<script type="text/javascript" src="/media/djangologdb/js/jquery.flot-0.6.min.js"></script>
	<script type="text/javascript">
	$(function () {
		var options = {
			series: {
				lines: { show: true },
				points: { show: true },
				shadowSize: 0
			},
			yaxis: { min: 0, tickDecimals: 0 },
			xaxis: { tickDecimals: 0, mode: "time" }
		};

		var today = new Date();
		var start_date = new Date(today.getFullYear(), today.getMonth(), today.getDate() - 30);
		var end_date = new Date(today.getFullYear(), today.getMonth(), today.getDate());
		
		var params = {
			start_date: start_date.getTime(),
			end_date: end_date.getTime(),
			interval_days: 1,
			aggregate: '{{ aggregate }}'
		};

		$.getJSON('/admin/djangologdb/logentry/datasets/', params, function(datasets) {
			var data = [];

			$.each(datasets, function(key, val) {
				data.push(datasets[key]);
			});
			
			$.plot($("#chart"), data, options);
		});
	});
	</script>
{% endblock %}

{% block object-tools %}
	{{ block.super }}
	
	<div class="module" style="padding: 10px;">
		<div id="chart" style="height: 250px;"></div>
	</div>
{% endblock %}
